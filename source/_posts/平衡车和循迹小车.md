---
title: 个人项目|平衡车＋循迹小车
date : 2025-2-18 10:00:00
categories: 个人项目
description : 这篇算是一篇日记把，记录自己做平衡车和循迹小车的日记
top_img : https://cdn.jsdelivr.net/gh/C29999/P.bed/8554b18a676409de65940e0d459781c2.jpg
cover : https://cdn.jsdelivr.net/gh/C29999/P.bed/8554b18a676409de65940e0d459781c2.jpg
tags : 小车制作
---

## 平衡车

2.18 遇到编码器无法测速问题

2.19 记录自己第一次使用示波器

![示波器的使用](https://cdn.jsdelivr.net/gh/C29999/P.bed/a0b2361f18becf3a7cab3c06df496f1c.jpg)

关于之前编码器无法测速问题在我重新焊出第四块一模一样的板子后终于找到了答案(悲)

因为在焊接电路的时候电机端子焊反了，所以导致编码器电源正反反接了，无法正常给编码器供电，在制作平衡车过程中出了很多次硬件问题，下一个项目要好好检查硬件问题然后在写程序

2.20 关于平衡小车中使用的PID算法

核心控制函数:

``` c++
void Control(void) //核心控制函数

{
    int PWM_out;
    //读取编码器速度
    Encoder_Left=Read_Speed(&htim2);
    Encoder_Right=-Read_Speed(&htim4);
    mpu_dmp_get_data(&pitch,&roll,&yaw);
    MPU_Get_Gyroscope(&gyrox,&gyroy,&gyroz);
    MPU_Get_Accelerometer(&aacx,&aacy,&aacz);

    //遥控
    if((Fore==0)&&(Back==0))Target_Speed=0;//没有接受到遥控指令，速度为零
    if(Fore==1)
    {
        if(distance<50)
            Target_Speed--;
        else
            Target_Speed++;
    }
    if(Back==1){Target_Speed--;}//
    Target_Speed=Target_Speed>SPEED_Y?SPEED_Y:(Target_Speed<-SPEED_Y?(-SPEED_Y):Target_Speed);//??·ù

    /*左右*/
    if((Left==0)&&(Right==0))Target_turn=0;
    if(Left==1)Target_turn-=30;//左转
    if(Right==1)Target_turn+=30;=//右转
    Target_turn=Target_turn>SPEED_Z?SPEED_Z:(Target_turn<-SPEED_Z?(-SPEED_Z):Target_turn);//??·ù( (20*100) * 100   )

    //转向约束
    if((Left==0)&&(Right==0))Turn_Kd=0.6;
    else if((Left==1)||(Right==1))Turn_Kd=0;
//函数的核心，串极PID控制器
    Velocity_out=Velocity(Target_Speed,Encoder_Left,Encoder_Right);//速度环输出
    Vertical_out=Vertical(Velocity_out+Med_Angle,roll,gyrox);//直立环输出
    Turn_out=Turn(gyroz,Target_turn);//转向环输出
    PWM_out=Vertical_out;//PWM输出为直立环输出
    MOTO1=PWM_out-Turn_out;//减去转向换的输出，得到电机1的PWM值
    MOTO2=PWM_out+Turn_out;
    Limit(&MOTO1,&MOTO2);
    Load(MOTO1,~MOTO2);
}
```
