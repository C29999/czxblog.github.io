---
title: FRTOS学习
date : 2025-10-29 12:00:00
description : FRTOS
categories: 关于我
top_img : https://cdn.jsdelivr.net/gh/C29999/P.bed/0832c767e6558a3be965a14286e016f3.png
cover : https://cdn.jsdelivr.net/gh/C29999/P.bed/0832c767e6558a3be965a14286e016f3.png
tags : FRTOS
---

## 什么是FRTOS？

将FRTOS想象成一个超级高效的"任务管家"，它核心的工作就是让你的单片机能够同时“一心多用”，通过任务调度、消息队列、信号量等机制，来合理地安排多个任务（比如同时读取传感器、刷新屏幕、进行网络通信）的执行顺序和时间，确保那些最紧急的任务能得到优先处理，从而让你的嵌入式项目运行得更可靠、更有序。

## FRTOS基础

### 什么是任务栈

>什么是栈？
栈就是单片机RAM里面一段连续的内存空间，大小一般在启动文件里面或者连接脚本里面定义，通过外在的调用初始化
>
>>什么是任务栈？
>>在江湖中、各路豪杰英雌距地分割。每个人都有自己的地盘。那我内部的吃喝开销不是我自己负责？
同样，栈也是一个个独立的，每个栈都有自己的独立栈空间，只是这个栈空间需要提前定义好，就是一个全局数组

``` C++
/*定义任务栈的大小*/
#define TASK1_STACK_SIZE 128
StackType_t Task1Stack[TASK1_STACK_SIZE];

#define TASK2_STACK_SIZE 128
StackType_t Task2Stack[TASK2_STACK_SIZE];

#define TASK3_STACK_SIZE 128
StackType_t Task3Stack[TASK3_STACK_SIZE];
```

### 任务函数

任务函数是一个独立的线程，一个完整的嵌入式应用，就是由多个这样的任务函数所组成的

任务函数有两个关键特征：

***1.永不返回：通常，任务函数内部是一个无限的循环（for(;;) 或 while(1)），使得这个任务能够持续运行，永远不会return。***

***必须具有特定的原型：它的返回值必须是 void，并且接受一个 void * 类型的参数。***

代码框架：

``` C++

void myTaskFunction(void *pvParameters) // 必须符合这个函数原型
{
    // 可选的初始化代码
    

    for(;;) // 无限循环，永不返回
    {
        // 任务的主体工作代码...
        
        
        // 通常需要调用一个延迟或阻塞函数，如 vTaskDelay(),
        // 以便将CPU控制权主动交还给调度器，让其他任务有机会运行。
        vTaskDelay(1000 / portTICK_PERIOD_MS); // 延迟1000毫秒
    }
    
    // 理论上，如果任务被删除，才会执行到这里。
    // 良好的习惯是在这里调用 vTaskDelete(NULL) 来清理任务。
    vTaskDelete(NULL);
}

```

> 任务函数就是你在FreeRTOS中为实现特定功能而写的“灵魂”，而之前你提供的“任务栈”则是这个灵魂运行时所必需的“身体和记忆空间”。调度器负责管理所有这些“灵魂”，让它们和谐地共享一个CPU。

### 什么是TCB？

>TCB可以把它想象成一个任务的 “身份证” 或 “个人档案”。

TCB 是一个数据结构（一个 struct），由 FreeRTOS 内核在创建任务时自动分配。它包含了管理和调度一个任务所需要的 所有信息。

>>TCB里面有什么？
任务状态：当前任务是就绪、运行、阻塞还是挂起状态。

任务优先级：决定了调度器先运行哪个任务。

栈指针：指向任务的栈顶（就是你之前代码里定义的 Task1Stack 等数组），用于记录任务运行时和切换时的上下文（如变量、返回地址等）。

任务入口函数指针：指向你写的那个任务函数，告诉内核这个任务要执行什么代码。

任务名：用于调试时识别任务。

事件列表：记录任务正在等待什么事件（比如信号量、消息队列等）。

其他用于链表、时间戳等的内核管理信息。

>>>TCB 是 FreeRTOS 用来代表一个任务的内核对象，是系统感知和管理任务的唯一依据。 你创建一个任务时，系统就会为它分配一个 TCB；删除一个任务时，就会释放它的 TCB

### 采用STM32G431＋ CUBEMX学习STM32

#### 使用FRTOS实现点灯


