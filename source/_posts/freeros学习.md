---
title: FRTOSå­¦ä¹ 
description: FRTOS
categories: å…³äºæˆ‘
top_img: 'https://cdn.jsdelivr.net/gh/C29999/P.bed/0832c767e6558a3be965a14286e016f3.png'
cover: 'https://cdn.jsdelivr.net/gh/C29999/P.bed/0832c767e6558a3be965a14286e016f3.png'
tags: FRTOS
abbrlink: 52907
date: 2025-10-29 12:00:00
---

## ä»€ä¹ˆæ˜¯FRTOSï¼Ÿ

å°†FRTOSæƒ³è±¡æˆä¸€ä¸ªè¶…çº§é«˜æ•ˆçš„"ä»»åŠ¡ç®¡å®¶"ï¼Œå®ƒæ ¸å¿ƒçš„å·¥ä½œå°±æ˜¯è®©ä½ çš„å•ç‰‡æœºèƒ½å¤ŸåŒæ—¶â€œä¸€å¿ƒå¤šç”¨â€ï¼Œé€šè¿‡ä»»åŠ¡è°ƒåº¦ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ç­‰æœºåˆ¶ï¼Œæ¥åˆç†åœ°å®‰æ’å¤šä¸ªä»»åŠ¡ï¼ˆæ¯”å¦‚åŒæ—¶è¯»å–ä¼ æ„Ÿå™¨ã€åˆ·æ–°å±å¹•ã€è¿›è¡Œç½‘ç»œé€šä¿¡ï¼‰çš„æ‰§è¡Œé¡ºåºå’Œæ—¶é—´ï¼Œç¡®ä¿é‚£äº›æœ€ç´§æ€¥çš„ä»»åŠ¡èƒ½å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œä»è€Œè®©ä½ çš„åµŒå…¥å¼é¡¹ç›®è¿è¡Œå¾—æ›´å¯é ã€æ›´æœ‰åºã€‚


***FRTOSå®ç°ä»»åŠ¡è·³è½¬ï¼Œåªä¼šæ‰§è¡Œä¸»å‡½æ•°å‰åŠéƒ¨åˆ†ï¼Œåé¢åªä¼šæ‰§è¡ŒRTOSä¸­çš„ä»»åŠ¡***

## FRTOSåŸºç¡€

### ä»€ä¹ˆæ˜¯ä»»åŠ¡æ ˆ

>ä»€ä¹ˆæ˜¯æ ˆï¼Ÿ
æ ˆå°±æ˜¯å•ç‰‡æœºRAMé‡Œé¢ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¤§å°ä¸€èˆ¬åœ¨å¯åŠ¨æ–‡ä»¶é‡Œé¢æˆ–è€…è¿æ¥è„šæœ¬é‡Œé¢å®šä¹‰ï¼Œé€šè¿‡å¤–åœ¨çš„è°ƒç”¨åˆå§‹åŒ–
>
>>ä»€ä¹ˆæ˜¯ä»»åŠ¡æ ˆï¼Ÿ
>>åœ¨æ±Ÿæ¹–ä¸­ã€å„è·¯è±ªæ°è‹±é›Œè·åœ°åˆ†å‰²ã€‚æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„åœ°ç›˜ã€‚é‚£æˆ‘å†…éƒ¨çš„åƒå–å¼€é”€ä¸æ˜¯æˆ‘è‡ªå·±è´Ÿè´£ï¼Ÿ
åŒæ ·ï¼Œæ ˆä¹Ÿæ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„ï¼Œæ¯ä¸ªæ ˆéƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹æ ˆç©ºé—´ï¼Œåªæ˜¯è¿™ä¸ªæ ˆç©ºé—´éœ€è¦æå‰å®šä¹‰å¥½ï¼Œå°±æ˜¯ä¸€ä¸ªå…¨å±€æ•°ç»„

``` C++
/*å®šä¹‰ä»»åŠ¡æ ˆçš„å¤§å°*/
#define TASK1_STACK_SIZE 128
StackType_t Task1Stack[TASK1_STACK_SIZE];

#define TASK2_STACK_SIZE 128
StackType_t Task2Stack[TASK2_STACK_SIZE];

#define TASK3_STACK_SIZE 128
StackType_t Task3Stack[TASK3_STACK_SIZE];
```

### ä»»åŠ¡å‡½æ•°

ä»»åŠ¡å‡½æ•°æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸€ä¸ªå®Œæ•´çš„åµŒå…¥å¼åº”ç”¨ï¼Œå°±æ˜¯ç”±å¤šä¸ªè¿™æ ·çš„ä»»åŠ¡å‡½æ•°æ‰€ç»„æˆçš„

ä»»åŠ¡å‡½æ•°æœ‰ä¸¤ä¸ªå…³é”®ç‰¹å¾ï¼š

***1.æ°¸ä¸è¿”å›ï¼šé€šå¸¸ï¼Œä»»åŠ¡å‡½æ•°å†…éƒ¨æ˜¯ä¸€ä¸ªæ— é™çš„å¾ªç¯ï¼ˆfor(;;) æˆ– while(1)ï¼‰ï¼Œä½¿å¾—è¿™ä¸ªä»»åŠ¡èƒ½å¤ŸæŒç»­è¿è¡Œï¼Œæ°¸è¿œä¸ä¼šreturnã€‚***

***å¿…é¡»å…·æœ‰ç‰¹å®šçš„åŸå‹ï¼šå®ƒçš„è¿”å›å€¼å¿…é¡»æ˜¯ voidï¼Œå¹¶ä¸”æ¥å—ä¸€ä¸ª void * ç±»å‹çš„å‚æ•°ã€‚***

ä»£ç æ¡†æ¶ï¼š

``` C++

void myTaskFunction(void *pvParameters) // å¿…é¡»ç¬¦åˆè¿™ä¸ªå‡½æ•°åŸå‹
{
    // å¯é€‰çš„åˆå§‹åŒ–ä»£ç 
    

    for(;;) // æ— é™å¾ªç¯ï¼Œæ°¸ä¸è¿”å›
    {
        // ä»»åŠ¡çš„ä¸»ä½“å·¥ä½œä»£ç ...
        
        
        // é€šå¸¸éœ€è¦è°ƒç”¨ä¸€ä¸ªå»¶è¿Ÿæˆ–é˜»å¡å‡½æ•°ï¼Œå¦‚ vTaskDelay(),
        // ä»¥ä¾¿å°†CPUæ§åˆ¶æƒä¸»åŠ¨äº¤è¿˜ç»™è°ƒåº¦å™¨ï¼Œè®©å…¶ä»–ä»»åŠ¡æœ‰æœºä¼šè¿è¡Œã€‚
        vTaskDelay(1000 / portTICK_PERIOD_MS); // å»¶è¿Ÿ1000æ¯«ç§’
    }
    
    // ç†è®ºä¸Šï¼Œå¦‚æœä»»åŠ¡è¢«åˆ é™¤ï¼Œæ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œã€‚
    // è‰¯å¥½çš„ä¹ æƒ¯æ˜¯åœ¨è¿™é‡Œè°ƒç”¨ vTaskDelete(NULL) æ¥æ¸…ç†ä»»åŠ¡ã€‚
    vTaskDelete(NULL);
}

```


ä»»åŠ¡å‡½æ•°å’Œæ™®é€šFRTOSçš„åŒºåˆ«ï¼š

>**1.è°ƒç”¨æ–¹å¼ï¼š**
ã€‚æ™®é€šå‡½æ•°æ˜¯é€šè¿‡ç¨‹åºä¸­çš„æ˜¾å¼è°ƒç”¨æ¥æ‰§è¡Œçš„ï¼Œæ‰§è¡Œå®Œåè¿”å›åˆ°è°ƒç”¨ç‚¹ã€‚
ã€‚FreeRTOSä»»åŠ¡åœ¨åˆ›å»ºåç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ç®¡ç†ï¼Œå¹¶åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¢«è¿è¡Œï¼Œä»»åŠ¡é—´çš„åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿå®Œæˆã€‚
**2.è¿è¡Œæ–¹å¼ï¼š**
ã€‚æ™®é€šå‡½æ•°çš„æ‰§è¡Œæ˜¯é¡ºåºä¸”é˜»å¡çš„ã€‚
ã€‚ä»»åŠ¡æ˜¯éé˜»å¡çš„ï¼Œæ”¯æŒå¤šä»»åŠ¡å¹¶å‘ã€‚æ“ä½œç³»ç»Ÿä¼šæ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§å’Œæ—¶é—´ç‰‡è°ƒåº¦æœºåˆ¶åœ¨ä¸åŒä»»åŠ¡ä¹‹é—´åˆ‡æ¢ã€‚
**3.ä¸Šä¸‹æ–‡ç®¡ç†ï¼š**
æ™®é€šå‡½æ•°ä¸è°ƒç”¨ç‚¹å…±äº«ç›¸åŒçš„å †æ ˆå’Œä¸Šä¸‹æ–‡ã€‚
æ¯ä¸ªä»»åŠ¡æœ‰ç‹¬ç«‹çš„å †æ ˆç©ºé—´å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ“ä½œç³»ç»Ÿåœ¨ä»»åŠ¡åˆ‡æ¢æ—¶ä¼šä¿å­˜å’Œæ¢å¤è¿™äº›ä¿¡æ¯ã€‚
>

> ä»»åŠ¡å‡½æ•°å°±æ˜¯ä½ åœ¨FreeRTOSä¸­ä¸ºå®ç°ç‰¹å®šåŠŸèƒ½è€Œå†™çš„â€œçµé­‚â€ï¼Œè€Œä¹‹å‰ä½ æä¾›çš„â€œä»»åŠ¡æ ˆâ€åˆ™æ˜¯è¿™ä¸ªçµé­‚è¿è¡Œæ—¶æ‰€å¿…éœ€çš„â€œèº«ä½“å’Œè®°å¿†ç©ºé—´â€ã€‚è°ƒåº¦å™¨è´Ÿè´£ç®¡ç†æ‰€æœ‰è¿™äº›â€œçµé­‚â€ï¼Œè®©å®ƒä»¬å’Œè°åœ°å…±äº«ä¸€ä¸ªCPUã€‚

### ä»€ä¹ˆæ˜¯TCBï¼Ÿ

>TCBå¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä»»åŠ¡çš„ â€œèº«ä»½è¯â€ æˆ– â€œä¸ªäººæ¡£æ¡ˆâ€ã€‚

TCB æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆä¸€ä¸ª structï¼‰ï¼Œç”± FreeRTOS å†…æ ¸åœ¨åˆ›å»ºä»»åŠ¡æ—¶è‡ªåŠ¨åˆ†é…ã€‚å®ƒåŒ…å«äº†ç®¡ç†å’Œè°ƒåº¦ä¸€ä¸ªä»»åŠ¡æ‰€éœ€è¦çš„ æ‰€æœ‰ä¿¡æ¯ã€‚

>>TCBé‡Œé¢æœ‰ä»€ä¹ˆï¼Ÿ
ä»»åŠ¡çŠ¶æ€ï¼šå½“å‰ä»»åŠ¡æ˜¯å°±ç»ªã€è¿è¡Œã€é˜»å¡è¿˜æ˜¯æŒ‚èµ·çŠ¶æ€ã€‚

ä»»åŠ¡ä¼˜å…ˆçº§ï¼šå†³å®šäº†è°ƒåº¦å™¨å…ˆè¿è¡Œå“ªä¸ªä»»åŠ¡ã€‚

æ ˆæŒ‡é’ˆï¼šæŒ‡å‘ä»»åŠ¡çš„æ ˆé¡¶ï¼ˆå°±æ˜¯ä½ ä¹‹å‰ä»£ç é‡Œå®šä¹‰çš„ Task1Stack ç­‰æ•°ç»„ï¼‰ï¼Œç”¨äºè®°å½•ä»»åŠ¡è¿è¡Œæ—¶å’Œåˆ‡æ¢æ—¶çš„ä¸Šä¸‹æ–‡ï¼ˆå¦‚å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰ã€‚

ä»»åŠ¡å…¥å£å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘ä½ å†™çš„é‚£ä¸ªä»»åŠ¡å‡½æ•°ï¼Œå‘Šè¯‰å†…æ ¸è¿™ä¸ªä»»åŠ¡è¦æ‰§è¡Œä»€ä¹ˆä»£ç ã€‚

ä»»åŠ¡åï¼šç”¨äºè°ƒè¯•æ—¶è¯†åˆ«ä»»åŠ¡ã€‚

äº‹ä»¶åˆ—è¡¨ï¼šè®°å½•ä»»åŠ¡æ­£åœ¨ç­‰å¾…ä»€ä¹ˆäº‹ä»¶ï¼ˆæ¯”å¦‚ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ã€‚

å…¶ä»–ç”¨äºé“¾è¡¨ã€æ—¶é—´æˆ³ç­‰çš„å†…æ ¸ç®¡ç†ä¿¡æ¯ã€‚

>>>TCB æ˜¯ FreeRTOS ç”¨æ¥ä»£è¡¨ä¸€ä¸ªä»»åŠ¡çš„å†…æ ¸å¯¹è±¡ï¼Œæ˜¯ç³»ç»Ÿæ„ŸçŸ¥å’Œç®¡ç†ä»»åŠ¡çš„å”¯ä¸€ä¾æ®ã€‚ ä½ åˆ›å»ºä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿå°±ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ª TCBï¼›åˆ é™¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå°±ä¼šé‡Šæ”¾å®ƒçš„ TCB

## é‡‡ç”¨STM32F104(è“æ¡¥æ¯å¼€å‘æ¿)ï¼‹ CUBEMXå­¦ä¹ STM32

### CUBEMXä¸­ç”Ÿæˆçš„FRTOSæ¶æ„

``` C

  //ç”¨äºå¼€å¯ä»»åŠ¡è°ƒåº¦ï¼Œåˆå§‹åŒ–è°ƒåº¦å™¨
  osKernelInitialize();  /* Call init function for freertos objects (in freertos.c) */


/*FRTOS.cçš„æ¶æ„*/
//åˆ›å»ºçš„ä¸¤ä¸ªä»»åŠ¡
  defaultTaskHandle = osThreadNew(StartDefaultTask, NULL, &defaultTask_attributes);

  /* creation of myTask02 */
  myTask02Handle = osThreadNew(StartTask02, NULL, &myTask02_attributes);


  //osThreadNew(StartTask02, NULL, &myTask02_attributes);å‡½æ•°æ€ä¹ˆç”¨ï¼Ÿ

  osThreadNew (osThreadFunc_t func, void *argument, const osThreadAttr_t *attr)

  
   osThreadFunc_t funcï¼šä»»åŠ¡å‡½æ•° ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆtypedef void ï¼ŒæŒ‡å‘ä»»åŠ¡å‡½æ•°(*osThreadFunc_t) (void *argument);

    void *argumentï¼šä¼ é€’ç»™ä»»åŠ¡å‡½æ•°çš„å‚æ•°
    const osThreadAttr_t *attr è®¾ç½®ä»»åŠ¡å±æ€§ï¼Œå¯ä»¥è®¾ç½®ä¸ºç©º
    è¿”å›å€¼ï¼šosThreadId_tä»»åŠ¡çš„IDï¼Œé€šè¿‡ä»»åŠ¡çš„IDæ‰¾åˆ°å¯¹åº”çš„ID

```

ä»»åŠ¡å‡½æ•°æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå› ä¸ºä»»åŠ¡éœ€è¦ä¸€ç›´ä¿æŒè¿è¡Œ
``` C++

void StartDefaultTask(void *argument)
{
  /* USER CODE BEGIN StartDefaultTask */
  /* Infinite loop */\
	
  for(;;)
  {
    osDelay(1);
  }
  /* USER CODE END StartDefaultTask */
}

  osDelay(10)//ä¼‘çœ å‡½æ•°ï¼Œé‡Šæ”¾CPUèµ„æº

```

### ä½¿ç”¨FRTOSå®ç°ä¸²å£å‘é€


é…ç½®é“¾æ¥ï¼š[STM32CubeMXç”Ÿæˆç¬¬ä¸€ä¸ªfreeRTOSå·¥ç¨‹](https://blog.csdn.net/LC_8575/article/details/142781687)
è“æ¡¥æ¯åµŒå…¥å¼åŸç†å›¾ï¼š

![ç‚¹äº®ä¸€ä¸ªLED](https://cdn.jsdelivr.net/gh/C29999/P.bed/ca3479b74e8483c35070d97aaec84e0e.png)


CUBEMXé…ç½®ï¼š![FRTOSç¬¬ä¸€æ¬¡é…ç½®](https://cdn.jsdelivr.net/gh/C29999/P.bed/49d7f1793924dfb764077d8c76ae91af.png)


å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯æ‰¾ä¸åˆ°å¤´æ–‡ä»¶é”™è¯¯

  ![STM32é”™è¯¯](https://cdn.jsdelivr.net/gh/C29999/P.bed/7f5d087659d444bb7c7bb7ffe51ec0d6.png)

 é‚£ä¹ˆå¤šåŠæ˜¯åœ¨FRTOSè®¾ç½®ä½¿ç”¨çš„æ–°çš„åº“ï¼Œæˆ‘åªéœ€è¦æŠŠè¿™ä¸€é¡¹å…³é—­å°±è¡Œ

   ![2](https://cdn.jsdelivr.net/gh/C29999/P.bed/7865b41b1e66147f547f971f5bcb83be.png)

``` C++

void StartDefaultTask(void *argument)
{
  /* USER CODE BEGIN StartDefaultTask */
  /* Infinite loop */\
	HAL_UART_Transmit(&huart1, (uint8_t *)"hello wi99ndows!\r\n", 16 , 0xffff);
  for(;;)
  {
    osDelay(50);
  }
  /* USER CODE END StartDefaultTask */
}
//ç›´æ¥åœ¨ä»»åŠ¡è½®è¯¢é‡Œé¢æ·»åŠ å³å¯

```

  ![STM](https://cdn.jsdelivr.net/gh/C29999/P.bed/4c8595b619fd56ac7f1c132be98fe50b.png)


   #### CUBEMXä»»åŠ¡åä»‹ç»
   ![STM](https://cdn.jsdelivr.net/gh/C29999/P.bed/b37e8a422d73b1573121be1905237a8c.png)

  ç¬¬äºŒè¡ŒPriorityç”¨æ¥è®¾ç½®ä»»åŠ¡ä¼˜å…ˆçº§
  ç¬¬ä¸‰è¡Œï¼šä»»åŠ¡æ ˆå¤§å°
  ç¬¬å››è¡Œ:ä»»åŠ¡çš„å…¥å£å‡½æ•°
  ç¬¬å…­è¡Œï¼šä¼ é€’ç»™ä»»åŠ¡å‡½æ•°çš„å‚æ•°
  ç¬¬ä¸ƒè¡Œï¼šä»»åŠ¡åˆ›å»ºçš„æ–¹å¼

  ``` c++

typedef struct {
  const char                   *name;   ///< name of the thread
  uint32_t                 attr_bits;   ///< attribute bits
  void                      *cb_mem;    ///< memory for control block
  uint32_t                   cb_size;   ///< size of provided memory for control block
  void                   *stack_mem;    ///< memory for stack
  uint32_t                stack_size;   ///< size of stack
  osPriority_t              priority;   ///< initial thread priority (default: osPriorityNormal)
  TZ_ModuleId_t            tz_module;   ///< TrustZone module identifier
  uint32_t                  reserved;   ///< reserved (must be 0)
} osThreadAttr_t;

  ```

>ä½¿ç”¨osThreadNewå‡½æ•°ä¼ å‚
æˆ‘ä»¬çœ‹åˆ°osThreadNewå‡½æ•°ç¬¬äºŒå‚æ•°, æ˜¯ä¼ å…¥ä»»åŠ¡å‡½æ•°çš„å‚æ•°

å®ç°åŠŸèƒ½:åˆ©ç”¨ä¸²å£å‘é€å…­æ¬¡ååœæ­¢

``` C++

  int c=6;
  defaultTaskHandle = osThreadNew(StartTask02, (void*)&c, &defaultTask_attributes);
void StartTask02(void *argument)
{
  /* USER CODE BEGIN StartTask02 */
  /* Infinite loop */
	int i=0;
	int* cnt =(int*)argument;
  for(;;)
  {
		for(i;i<*cnt;i++)
		{
			printf("hello world");
			printf("%d", i);
			osDelay(1000);
		}
    osDelay(1000);
  }
  /* USER CODE END StartTask02 */
}


```

### ä»»åŠ¡ä¼˜å…ˆçº§çš„ä½¿ç”¨

å’Œä¸­æ–­ä¸åŒçš„æ˜¯FRTOSä¸­çš„ä¼˜å…ˆçº§è¶Šé«˜,è¶Šå…ˆä½¿ç”¨

### ä»»åŠ¡çš„æ ˆ


#### å‡½æ•°è°ƒç”¨æ ˆ

æ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå‡½æ•°çš„è¿”å›åœ°å€ï¼Œå‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¼šè¢«ä¿æŒåœ¨æ ˆä¸Šï¼Œå‡½æ•°æ‰§è¡Œå®Œåï¼Œæ ˆä¼šæ¢å¤é“è°ƒç”¨ä¹‹å‰çš„çŠ¶æ€


### åˆ›å»ºä»»åŠ¡

#### åŠ¨æ€åˆ›å»ºä»»åŠ¡ä¸é™æ€åˆ›å»ºä»»åŠ¡

åŠ¨æ€å’Œé™æ€ä¸¤ç§åˆ›å»ºä»»åŠ¡çš„æ–¹å¼è¿™æ˜¯åœ¨FreeRTOS ä¸­åˆ›å»ºä»»åŠ¡çš„ä¸¤ç§å†…å­˜ç®¡ç†æ–¹å¼ã€‚

>åŠ¨æ€åˆ›å»ºä»»åŠ¡ï¼šFreeRTOS å†…æ ¸è‡ªåŠ¨åˆ†é…ä»»åŠ¡æ ˆå’Œ TCB æ‰€éœ€çš„å†…å­˜
>> ä¼˜ç‚¹ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œé€‚åˆä»»åŠ¡æ•°é‡ä¸ç¡®å®šæˆ–é¢‘ç¹å˜åŒ–çš„æƒ…å†µã€‚
ç¼ºç‚¹å¯èƒ½ä¼šç”Ÿæˆå†…å­˜ç¢ç‰‡

>é™æ€åˆ›å»ºä»»åŠ¡ï¼šç”¨æˆ·æ‰‹åŠ¨åˆ†é…å†…å­˜ï¼ŒåŒ…æ‹¬ TCB å’Œ æ ˆç©ºé—´
>>æ— å†…å­˜ç¢ç‰‡ï¼Œé€‚åˆå†…å­˜å—é™ç³»ç»Ÿ
>>è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜

CUBEMXç”Ÿæˆçš„åŠ¨æ€åº•å±‚ä»£ç :

``` C++

 (xTaskCreate ((TaskFunction_t)func, name, (uint16_t)stack, argument, prio, &hTask) != pdPASS)


BaseType_t xTaskCreate(	TaskFunction_t pxTaskCode,
							const char * const pcName,		/*lint !e971 Unqualified char types are allowed for strings and single characters only. */
							const configSTACK_DEPTH_TYPE usStackDepth,
							void * const pvParameters,
							UBaseType_t uxPriority,
							TaskHandle_t * const pxCreatedTask )

//(TaskFunction_t)func ä»»åŠ¡å‡½æ•°æŒ‡é’ˆ
//const char * const pcName ä»»åŠ¡åç§°
//const configSTACK_DEPTH_TYPE usStackDepth ä»»åŠ¡æ ˆå¤§å°
//void * const pvParameters ä»»åŠ¡å‚æ•°
//UBaseType_t uxPriority ä»»åŠ¡ä¼˜å…ˆçº§
//TaskHandle_t * const pxCreatedTask ä»»åŠ¡å¥æŸ„ï¼Œé€šè¿‡ä»»åŠ¡å¥æŸ„å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ä»»åŠ¡
//BaseType_t è¿”å›å€¼ï¼Œè¡¨ç¤ºå‡½æ•°æ˜¯å¦è°ƒç”¨æˆåŠŸ æˆåŠŸè¿”å›pdPASSï¼Œå¤±è´¥è¿”å›pdFAIL

```
##### å¦‚ä½•åŠ¨æ€åˆ›å»ºä»»åŠ¡å‡½æ•°

``` C++

TaskHandle_t MyTaskHandle;
xTaskCreate(StartMyTask, "MyTask", 256, (void*)&task_parameter, tskIDLE_PRIORITY + 2, &MyTaskHandle);

StartMyTask(void *pvParameters)
{
  for(;;)
  {

    osdelay();
  }
}
```

#### é™æ€åˆ›å»ºä»»åŠ¡

``` C++


StaticTask_t MyTaskTCB;
StackType_t MyTaskStack[256];

TaskHandle_t MyTaskHandle = xTaskCreateStatic(
    StartMyTask,           // ä»»åŠ¡å‡½æ•°æŒ‡é’ˆ
    "MyTask",              // ä»»åŠ¡åç§°  
    256,                   // ä»»åŠ¡æ ˆå¤§å°
    (void*)&task_parameter,// ä»»åŠ¡å‚æ•°
    tskIDLE_PRIORITY + 2,  // ä»»åŠ¡ä¼˜å…ˆçº§
    MyTaskStack,           // æ ˆç¼“å†²åŒº
    &MyTaskTCB             // TCBç¼“å†²åŒº
);

```

é™æ€åˆ›å»ºä»»åŠ¡å’ŒåŠ¨æ€åˆ›å»ºä»»åŠ¡çš„åŒºåˆ«ï¼š
åŠ¨æ€åˆ›å»ºåªéœ€æŒ‡å®šæ ˆå¤§å°ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ï¼›é™æ€åˆ›å»ºå¿…é¡»é¢å¤–æä¾›æ ˆå’Œä»»åŠ¡æ§åˆ¶å—çš„å…·ä½“å†…å­˜åœ°å€ï¼Œç”±å¼€å‘è€…é¢„å…ˆåˆ†é…å¥½æ‰€æœ‰å†…å­˜ç©ºé—´ã€‚

### å¦‚ä½•å®ç°ä»»åŠ¡è½®è¯¢

FreeRTOS é€šè¿‡ åŸºäºä¼˜å…ˆçº§çš„æŠ¢å å¼è°ƒåº¦ å®ç°ä»»åŠ¡è½®è¯¢ï¼šè°ƒåº¦å™¨å€ŸåŠ©ç¡¬ä»¶å®šæ—¶å™¨ä¸­æ–­å‘¨æœŸæ€§åœ°è§¦å‘ï¼Œæ£€æŸ¥æ‰€æœ‰ä»»åŠ¡çŠ¶æ€ï¼Œå§‹ç»ˆè®© æœ€é«˜ä¼˜å…ˆçº§çš„å°±ç»ªä»»åŠ¡ è·å¾— CPU ä½¿ç”¨æƒï¼›æ¯ä¸ªä»»åŠ¡å¿…é¡» ä¸»åŠ¨è°ƒç”¨å¦‚ osDelay ç­‰é˜»å¡å‡½æ•° æ¥è®©å‡º CPUï¼Œä»è€Œä¿è¯åŒç­‰ä¼˜å…ˆçº§çš„ä»»åŠ¡èƒ½é€šè¿‡ æ—¶é—´ç‰‡è½®è½¬ å…¬å¹³å…±äº«å¤„ç†å™¨ï¼Œå®ç°å¤šä»»åŠ¡çš„å¹¶å‘æ‰§è¡Œä¸å¹³æ»‘åˆ‡æ¢

>æ¯”å–»ï¼šFreeRTOS å°±åƒä¸€ä¸ªæ°¸ä¸ç–²å€¦çš„è¶…çº§æŒ‡æŒ¥å®¶ï¼Œå®ƒæ‰‹æ¡ä¸€ä¸ªç²¾å‡†çš„èŠ‚æ‹å™¨ï¼ˆç³»ç»Ÿå¿ƒè·³ï¼‰ï¼ŒæŒ‡æŒ¥ç€æ•´ä¸ªä¹é˜Ÿï¼ˆå¤šä¸ªä»»åŠ¡ï¼‰ã€‚æ¯ä¸€ä½ä¹æ‰‹ï¼ˆä»»åŠ¡ï¼‰éƒ½å¿…é¡»åœ¨æ¼”å¥å®Œè‡ªå·±çš„ä¸€ä¸ªå°èŠ‚åï¼Œä¸»åŠ¨åœä¸‹æ¥ï¼ˆè°ƒç”¨å¦‚ osDelay è¿™æ ·çš„å‡½æ•°ï¼‰ï¼ŒæŠŠèˆå°è®©ç»™æŒ‡æŒ¥ã€‚æŒ‡æŒ¥åˆ™éµå¾ªä¸€æ¡é»„é‡‘æ³•åˆ™ï¼šè°çš„ä»»åŠ¡æ›´ç´§æ€¥ã€è°ç­‰å¾—æœ€ä¹…ï¼Œå°±è®©è°æ¥ä¸‹æ¥è¡¨æ¼”ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒæŒ‡æŒ¥å®¶ç¡®ä¿äº†æ‰€æœ‰ä¹æ‰‹éƒ½èƒ½è½®æµä¸Šåœºï¼Œæ—¢ä¸ä¼šæœ‰äººä¸€ç›´éœ¸å éº¦å…‹é£ï¼Œä¹Ÿä¸ä¼šæœ‰äººè¢«å½»åº•å†·è½ï¼Œä»è€Œå¥å‡ºä¸€æ›²å’Œè°æµç•…çš„å¤šä»»åŠ¡äº¤å“ä¹

### ä»»åŠ¡è°ƒåº¦ç®—æ³•

#### æŠ¢å å¼ä»»åŠ¡è°ƒåº¦

***æŠ¢å å¼ä»»åŠ¡è°ƒåº¦***è¿è¡Œåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒåŸºäºä»»åŠ¡ä¼˜å…ˆçº§åŠ¨æ€æŠ¢å CPUèµ„æºï¼Œæš‚åœå½“å‰ä»»åŠ¡å¹¶åˆ‡æ¢åˆ°å…¶ä»–ä»»åŠ¡ï¼ŒFROTSå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§æ¥å†³å®šå“ªä¸ªä»»åŠ¡åº”å½“è¿è¡Œ


æŠ¢å å¼ä»»åŠ¡è°ƒåº¦å®éªŒï¼š
``` C++

void StartDefaultTask(void *argument)
{
  /* USER CODE BEGIN StartDefaultTask */
  /* Infinite loop */\
	//HAL_UART_Transmit(&huart1, (uint8_t *)"hello wi99ndows!\r\n", 16 , 0xffff);
  for(;;)
  {
    printf("text\n\r");
    myTask02Handle = osThreadNew(StartTask02, NULL, &myTask02_attributes);
    printf("11212\n\r");
    osDelay(2000);
  }
  /* USER CODE END StartDefaultTask */
}

/* USER CODE BEGIN Header_StartTask02 */
/**
* @brief Function implementing the myTask02 thread.
* @param argument: Not used
* @retval None
*/
/* USER CODE END Header_StartTask02 */
void StartTask02(void *argument)
{
  /* USER CODE BEGIN StartTask02 */
  /* Infinite loop */
	int i=0;
	int* cnt =(int*)argument;
  for(;;)
  {
		printf("hello world\n\r");
	  osDelay(2000);
  }
  /* USER CODE END StartTask02 */
}
```


#### å…³äºFreeRTOSConfig.h

FreeRTOSConfig.hæ–‡ä»¶æ˜¯FreeRTOSçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå…è®¸ç”¨æˆ·æ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚æ¥å®šåˆ¶å’Œä¼˜åŒ–FreeRTOSçš„è¿è¡Œæ—¶è¡Œä¸ºã€‚

``` C++

 /* è°ƒåº¦æ¨¡å¼é…ç½® */
#define configUSE_PREEMPTION                     1       /* 1=å¯ç”¨æŠ¢å å¼è°ƒåº¦ï¼Œ0=åä½œå¼è°ƒåº¦ */

/* å†…å­˜åˆ†é…æ–¹å¼é…ç½® */
#define configSUPPORT_STATIC_ALLOCATION          1       /* 1=æ”¯æŒé™æ€å†…å­˜åˆ†é…ï¼ˆç”¨æˆ·æä¾›å†…å­˜ï¼‰ */
#define configSUPPORT_DYNAMIC_ALLOCATION         1       /* 1=æ”¯æŒåŠ¨æ€å†…å­˜åˆ†é…ï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼‰ */

/* é’©å­å‡½æ•°é…ç½® */
#define configUSE_IDLE_HOOK                      0       /* 1=å¯ç”¨ç©ºé—²ä»»åŠ¡é’©å­å‡½æ•°ï¼Œ0=ç¦ç”¨ */
#define configUSE_TICK_HOOK                      0       /* 1=å¯ç”¨ç³»ç»Ÿå¿ƒè·³é’©å­å‡½æ•°ï¼Œ0=ç¦ç”¨ */

/* ç³»ç»Ÿæ—¶é’Ÿé…ç½® */
#define configCPU_CLOCK_HZ                       ( SystemCoreClock )  /* CPUæ—¶é’Ÿé¢‘ç‡ï¼Œé€šå¸¸ç­‰äºç³»ç»Ÿæ ¸å¿ƒæ—¶é’Ÿ */
#define configTICK_RATE_HZ                       ((TickType_t)1000)   /* ç³»ç»Ÿå¿ƒè·³é¢‘ç‡=1000Hzï¼Œå³1ä¸ªtick=1ms */

/* ä»»åŠ¡ç³»ç»Ÿé…ç½® */
#define configMAX_PRIORITIES                     (56)    /* æœ€å¤§ä¼˜å…ˆçº§æ•°é‡ï¼ŒèŒƒå›´1-255 */
#define configMINIMAL_STACK_SIZE                 ((uint16_t)128)      /* ç©ºé—²ä»»åŠ¡çš„æœ€å°æ ˆå¤§å°ï¼ˆå­—ï¼‰ */
#define configTOTAL_HEAP_SIZE                    ((size_t)3072)       /* åŠ¨æ€å†…å­˜åˆ†é…çš„æ€»å †å¤§å°=3KB */
#define configMAX_TASK_NAME_LEN                  ( 16 )  /* ä»»åŠ¡åç§°æœ€å¤§é•¿åº¦ */

/* è°ƒè¯•å’Œè·Ÿè¸ªé…ç½® */
#define configUSE_TRACE_FACILITY                 1       /* 1=å¯ç”¨å¯è§†åŒ–è·Ÿè¸ªè°ƒè¯•åŠŸèƒ½ */

/* æ—¶é—´ç³»ç»Ÿé…ç½® */
#define configUSE_16_BIT_TICKS                   0       /* 0=ä½¿ç”¨32ä½tickè®¡æ•°å™¨ï¼Œ1=ä½¿ç”¨16ä½ï¼ˆå·²è¿‡æ—¶ï¼‰ */

/* å†…æ ¸å¯¹è±¡é…ç½® */
#define configUSE_MUTEXES                        1       /* 1=å¯ç”¨äº’æ–¥é”åŠŸèƒ½ */
#define configQUEUE_REGISTRY_SIZE                8       /* é˜Ÿåˆ—æ³¨å†Œè¡¨å¤§å°ï¼Œç”¨äºè°ƒè¯• */
#define configUSE_RECURSIVE_MUTEXES              1       /* 1=å¯ç”¨é€’å½’äº’æ–¥é” */
#define configUSE_COUNTING_SEMAPHORES            1       /* 1=å¯ç”¨è®¡æ•°ä¿¡å·é‡ */

/* ä»»åŠ¡é€‰æ‹©ä¼˜åŒ– */
#define configUSE_PORT_OPTIMISED_TASK_SELECTION  0       /* 1=ä½¿ç”¨ç«¯å£ä¼˜åŒ–çš„ä»»åŠ¡é€‰æ‹©ï¼ˆä¾èµ–ç¡¬ä»¶ï¼‰ï¼Œ0=é€šç”¨Cä»£ç  */

```

#### FRTOSä»»åŠ¡ä¸­çš„çŠ¶æ€

FreeRTOS ä»»åŠ¡æ‹¥æœ‰å››ç§æ ¸å¿ƒçŠ¶æ€ï¼šè¿è¡Œæ€ï¼ˆæ­£åœ¨CPUæ‰§è¡Œï¼‰ã€å°±ç»ªæ€ï¼ˆå·²å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…è°ƒåº¦å™¨åˆ†é…CPUï¼‰ã€é˜»å¡æ€ï¼ˆå› ç­‰å¾…äº‹ä»¶æˆ–å»¶æ—¶è€Œæš‚åœï¼Œä¸å‚ä¸è°ƒåº¦ï¼‰ä»¥åŠæŒ‚èµ·æ€ï¼ˆè¢«å¼ºåˆ¶æš‚åœï¼Œåªèƒ½æ‰‹åŠ¨æ¢å¤ï¼‰ï¼Œä»»åŠ¡æ ¹æ®ç³»ç»Ÿè°ƒåº¦å’Œäº‹ä»¶è§¦å‘åœ¨è¿™äº›çŠ¶æ€é—´åŠ¨æ€åˆ‡æ¢ï¼Œç¡®ä¿å¤šä»»åŠ¡é«˜æ•ˆå¹¶å‘æ‰§è¡Œ


 ![111](https://cdn.jsdelivr.net/gh/C29999/P.bed/f066eb3878d122d3f424c4e6d43257bc.png)

##### å°±ç»ªçŠ¶æ€ï¼ˆReadyï¼‰

çŠ¶æ€æè¿°ï¼šä»»åŠ¡å·²ç»å‡†å¤‡å°±ç»ªï¼Œå…·å¤‡æ‰€æœ‰è¿è¡Œæ¡ä»¶ï¼Œæ­£åœ¨ç­‰å¾…è°ƒåº¦å™¨åˆ†é… CPU æ—¶é—´

å¤„äºå°±ç»ªæ€

>ä»»åŠ¡åˆšåˆ›å»ºå®Œæˆæ—¶
>
>ä»é˜»å¡æ€æ¢å¤ï¼ˆäº‹ä»¶å‘ç”Ÿ/å»¶æ—¶åˆ°æœŸï¼‰
>
>ä»æŒ‚èµ·æ€æ¢å¤
>
>è¢«æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡æŠ¢å å

##### é˜»å¡æ€ï¼ˆBlockedï¼‰

çŠ¶æ€æè¿°ï¼šä»»åŠ¡å› ç­‰å¾…ç‰¹å®šäº‹ä»¶è€Œæš‚åœæ‰§è¡Œï¼Œä¸å‚ä¸è°ƒåº¦ï¼Œç›´åˆ°ç­‰å¾…çš„æ¡ä»¶æ»¡è¶³ã€‚

ç‰¹ç‚¹ï¼š
âŒ ä¸å‚ä¸è°ƒåº¦

âœ… è‡ªåŠ¨æ¢å¤ï¼ˆäº‹ä»¶è§¦å‘ï¼‰

ğŸ’¤ ä¸æ¶ˆè€—CPUèµ„æº

å¸¸è§é˜»å¡æ¡ä»¶ï¼šä¿¡å·é‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®šæ—¶å™¨ç­‰

##### è¿è¡Œæ€ï¼ˆRunningï¼‰

çŠ¶æ€æè¿°ï¼šä»»åŠ¡å½“å‰æ­£åœ¨ CPU ä¸Šæ‰§è¡Œä»£ç ï¼Œå ç”¨å¤„ç†å™¨èµ„æºã€‚

>è¢«è°ƒåº¦å™¨ä»å°±ç»ªæ€é€‰ä¸­æ‰§è¡Œ
>
>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡

##### æŒ‚èµ·æ€ï¼ˆSuspendedï¼‰

æ²¡æœ‰åŠæ³•è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œä»»åŠ¡è¢«å¼ºåˆ¶æš‚åœæ‰§è¡Œï¼Œä¸å‚ä¸ä»»ä½•è°ƒåº¦ï¼Œåªèƒ½æ‰‹åŠ¨æ¢å¤ã€‚

[åŠ¨æ€è¡¨ç¤ºå››ç§çŠ¶æ€](https://www.bilibili.com/video/BV1xM1KB3EXr/?spm_id_from=333.337.search-card.all.click&vd_source=35e34a8c020f6931dec5585c4482ad05)

#### ç©ºé—²ä»»åŠ¡å’Œç©ºé—²é’©å­å‡½æ•°

>ç©ºé—²ä»»åŠ¡ï¼šç©ºé—²ä»»åŠ¡ æ˜¯ FreeRTOS è‡ªåŠ¨åˆ›å»ºçš„ä¸€ä¸ªç³»ç»Ÿä»»åŠ¡ï¼Œå®ƒå§‹ç»ˆå¤„äºæœ€ä½ä¼˜å…ˆçº§ï¼Œå½“ä¸”ä»…å½“ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·ä»»åŠ¡éƒ½å¤„äºé˜»å¡æˆ–æŒ‚èµ·çŠ¶æ€æ—¶ï¼Œè°ƒåº¦å™¨æ‰ä¼šåˆ‡æ¢åˆ°ç©ºé—²ä»»åŠ¡æ¥è¿è¡Œï¼Œå®ƒçš„å­˜åœ¨ç¡®ä¿äº† CPU æ°¸è¿œä¸ä¼šåœæ­¢æ‰§è¡Œï¼ŒåŒæ—¶ä¸ºå¼€å‘è€…æä¾›äº†é€šè¿‡ç©ºé—²ä»»åŠ¡é’©å­å‡½æ•°åœ¨ç³»ç»Ÿâ€œç©ºé—²â€æ—¶æ‰§è¡Œåå°ç»´æŠ¤æˆ–è¿›å…¥ä½åŠŸè€—æ¨¡å¼çš„æœºä¼š

 ![ç©ºé—²é’©å­å‡½æ•°](https://cdn.jsdelivr.net/gh/C29999/P.bed/243fca50abb12220614e1c2f57be5289.png)



ä»€ä¹ˆæ˜¯ç©ºé—²é’©å­å‡½æ•°ï¼Ÿ

ç©ºé—²é’©å­å‡½æ•°çš„ä½œç”¨:æŒ‚è½½åˆ°ç©ºé—²ä»»åŠ¡ä¸Šçš„è‡ªå®šä¹‰å‡½æ•°ï¼Œåœ¨ç³»ç»Ÿç©ºé—²æ—¶è‡ªåŠ¨æ‰§è¡Œ

å¦‚ä½•å¼€å¯ç©ºé—²é’©å­å‡½æ•°ï¼Ÿ
 ![ç©ºé—²é’©å­å‡½æ•°çš„å¼€å¯](https://cdn.jsdelivr.net/gh/C29999/P.bed/f452cc037be6b95bb858bb9cf8f0bfdd.png)


#####  ä»»åŠ¡æ§åˆ¶å—

###### TCBçš„åŸºæœ¬æ¦‚å¿µ

TCBï¼ˆä»»åŠ¡æ§åˆ¶å—ï¼‰ æ˜¯ FreeRTOS ä¸­ç”¨äºæè¿°å’Œç®¡ç†ä¸€ä¸ªä»»åŠ¡æ‰€æœ‰ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ TCBï¼Œç›¸å½“äºä»»åŠ¡çš„"èº«ä»½è¯"æˆ–"äººäº‹æ¡£æ¡ˆ"

``` C++
typedef struct tskTaskControlBlock
{
    /* 1. æ ˆæŒ‡é’ˆ */
    volatile StackType_t *pxTopOfStack;    // å½“å‰æ ˆé¡¶ä½ç½®
    
    /* 2. ä»»åŠ¡çŠ¶æ€ */
    eTaskState eCurrentState;              // å½“å‰çŠ¶æ€ï¼šå°±ç»ªã€è¿è¡Œã€é˜»å¡ã€æŒ‚èµ·
    
    /* 3. ä»»åŠ¡ä¼˜å…ˆçº§ */
    UBaseType_t uxPriority;                // ä»»åŠ¡ä¼˜å…ˆçº§ (0 = æœ€ä½)
    
    /* 4. ä»»åŠ¡å‡½æ•°å’Œå‚æ•° */
    TaskFunction_t pvTaskCode;             // æŒ‡å‘ä»»åŠ¡å‡½æ•°çš„æŒ‡é’ˆ
    void *pvParameters;                    // ä¼ é€’ç»™ä»»åŠ¡çš„å‚æ•°
    
    /* 5. ä»»åŠ¡åï¼ˆç”¨äºè°ƒè¯•ï¼‰ */
    const char *pcTaskName;                // ä»»åŠ¡åç§°å­—ç¬¦ä¸²
    
    /* 6. äº‹ä»¶ç›¸å…³ */
    void *pvEventList;                     // äº‹ä»¶åˆ—è¡¨é¡¹ï¼ˆç­‰å¾…é˜Ÿåˆ—ã€ä¿¡å·é‡ç­‰ï¼‰
    
    /* 7. æ—¶é—´ç®¡ç† */
    TickType_t xTicksToDelay;              // å‰©ä½™å»¶æ—¶æ—¶é—´ï¼ˆå¦‚æœå¤„äºé˜»å¡æ€ï¼‰
    
    /* 8. æ ˆä¿¡æ¯ */
    StackType_t *pxStack;                  // æ ˆèµ·å§‹åœ°å€
    uint16_t usStackDepth;                 // æ ˆæ·±åº¦
    
    /* 9. é“¾è¡¨æŒ‡é’ˆ */
    struct tskTaskControlBlock *pxNextTask; // å°±ç»ª/é˜»å¡é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªä»»åŠ¡
    struct tskTaskControlBlock *pxPreviousTask; // å°±ç»ª/é˜»å¡é“¾è¡¨ä¸­çš„å‰ä¸€ä¸ªä»»åŠ¡
    
} tskTCB;
```

#### ä»»åŠ¡çš„åˆ é™¤

FreeRTOS å®ç°ä»»åŠ¡åˆ é™¤ä¸»è¦é€šè¿‡ vTaskDelete() å‡½æ•°å®Œæˆï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨ã€æœ‰åºçš„èµ„æºæ¸…ç†è¿‡ç¨‹ã€‚

``` C++

vTaskDelete(xTaskHandle);  // xTaskHandle æ˜¯è¦åˆ é™¤çš„ä»»åŠ¡å¥æŸ„
vTaskDelete(NULL);  
// å‚æ•°ä¸ºNULLè¡¨ç¤ºåˆ é™¤è‡ªå·±
```

å½“ä»»åŠ¡è¢«åˆ é™¤åï¼Œå°±ä¼šè¢«ç§»é™¤ä»»åŠ¡è°ƒåº¦åˆ—è¡¨
è¡¨ç¤ºæ‰§è¡Œäº”æ¬¡åï¼Œåˆ é™¤è‡ªå·±ï¼š
``` C++ 
void StartDefaultTask(void *argument)
{
  /* USER CODE BEGIN StartDefaultTask */
  /* Infinite loop */\
	//HAL_UART_Transmit(&huart1, (uint8_t *)"hello wi99ndows!\r\n", 16 , 0xffff);
  int i=0;
  for(;;)
  {
    for(i=0;i<5;i++){
    printf("text\n\r");
    printf("11212\n\r");
		    osDelay(2000);}
    vTaskDelete(NULL);
  }
  /* USER CODE END StartDefaultTask */
}

```

#### åŒæ­¥å’Œäº’æ–¥

åŒæ­¥å’Œäº’æ–¥æ˜¯å¤šä»»åŠ¡ç³»ç»Ÿä¸­è§£å†³ä»»åŠ¡åä½œå’Œèµ„æºå…±äº«é—®é¢˜çš„ä¸¤ç§æ ¸å¿ƒæœºåˆ¶

##### åŒæ­¥


åŒæ­¥ = ä»»åŠ¡é—´çš„åä½œæœºåˆ¶ï¼Œç¡®ä¿å¤šä¸ªä»»åŠ¡æŒ‰ç…§é¢„æœŸçš„é¡ºåºæ‰§è¡Œ

å°±åƒå·¥å‚çš„æµæ°´çº¿ï¼šAå·¥åºå®Œæˆåï¼ŒBå·¥åºæ‰èƒ½å¼€å§‹

å°±åƒæ¥åŠ›èµ›è·‘ï¼šå‰ä¸€ä¸ªé€‰æ‰‹äº¤æ£’ï¼Œåä¸€ä¸ªé€‰æ‰‹æ‰èƒ½èµ·è·‘

##### äº’æ–¥

äº’æ–¥ = å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œé˜²æ­¢å¤šä¸ªä»»åŠ¡åŒæ—¶è®¿é—®ä¸´ç•Œèµ„æºã€‚

é˜²æ­¢å¤šä¸ªä»»åŠ¡åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå…¨å±€å˜é‡

ä¿æŠ¤å…±äº«ç¡¬ä»¶èµ„æºï¼ˆå¦‚ä¸²å£ã€SPIã€I2Cç­‰ï¼‰

é¿å…æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´

#### é˜Ÿåˆ—

é˜Ÿåˆ— æ˜¯ FreeRTOS ä¸­æœ€é‡è¦çš„ä»»åŠ¡é—´é€šä¿¡æœºåˆ¶ï¼Œå®ƒæä¾›äº†å®‰å…¨ã€å¯é çš„æ•°æ®ä¼ é€’æ–¹å¼ï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡å’Œæ•°æ®ç¼“å†²ã€‚

>æ¯”å–»ç†è§£ï¼š
>å°±åƒé‚®å±€çš„ä¿¡ç®±ï¼šå‘é€è€…æŠ•é€’ï¼Œæ¥æ”¶è€…å–ä»¶
>
>å°±åƒç”Ÿäº§çº¿ä¼ é€å¸¦ï¼šç”Ÿäº§è€…æ”¾äº§å“ï¼Œæ¶ˆè´¹è€…å–äº§å“

é˜Ÿåˆ—æ€ç»´å¯¼å›¾ï¼š
 ![FRTOS](https://cdn.jsdelivr.net/gh/C29999/P.bed/873f6107aeaf91e6a8f133d40c0d37e0.png)


##### ä¿¡å·é‡

***ä¿¡å·é‡***: æ˜¯ FreeRTOS ä¸­ç”¨äºä»»åŠ¡åŒæ­¥å’Œèµ„æºç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®æˆ–åè°ƒä»»åŠ¡é—´çš„æ‰§è¡Œé¡ºåº

äºŒè¿›åˆ¶ä¿¡å·é‡ï¼šå€¼åªæœ‰ 0 å’Œ 1ï¼Œç”¨äºäº’æ–¥è®¿é—®
è®¡æ•°ä¿¡å·é‡ï¼šå€¼å¯ä»¥å¤§äº 1ï¼Œç”¨äºèµ„æºæ± ç®¡ç†


STM32CUBEMXåˆ›å»ºä¿¡å·é‡çš„å°è£…å‡½æ•°ï¼š

``` C++

osSemaphoreId_t osSemaphoreNew (uint32_t max_count, uint32_t initial_count, const osSemaphoreAttr_t *attr)


//è¡¨ç¤ºï¼š
osSemaphoreId_t osSemaphoreNew (
    uint32_t max_count,           // æœ€å¤§è®¡æ•°å€¼
    uint32_t initial_count,       // åˆå§‹è®¡æ•°å€¼  
    const osSemaphoreAttr_t *attr // ä¿¡å·é‡å±æ€§
);



//ç”³è¯·ä¿¡å·é‡ï¼Œè¯·æ±‚ä¿¡å·é‡
osStatus_t osSemaphoreAcquire (
    osSemaphoreId_t semaphore_id,  // ä¿¡å·é‡å¥æŸ„
    uint32_t timeout               // è¶…æ—¶æ—¶é—´
);
//è¿”å›å€¼ä»£è¡¨æ˜¯å¦è¯·æ±‚æˆåŠŸï¼Œè¯·æ±‚ä¿¡å·é‡å®Œæˆåï¼Œä¿¡å·é‡å°±ä¼šå‡1ã€‚

//é‡Šæ”¾ä¿¡å·é‡
osStatus_t osSemaphoreRelease (
    osSemaphoreId_t semaphore_id  // ä¿¡å·é‡å¥æŸ„
);

//è¿”å›å€¼ä»£è¡¨æ˜¯å¦æˆåŠŸï¼Œé‡Šæ”¾ä¿¡å·é‡åï¼Œä¿¡å·é‡å°±ä¼šåŠ 1ã€‚

```

